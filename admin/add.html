<!doctype html>
<html lang="en">
<head>
<meta charset="utf-8"/><meta name="viewport" content="width=device-width, initial-scale=1"/>
<title>Add Item</title>
<link rel="stylesheet" href="../style.css"/>
</head>
<body>
<header class="topbar"><div class="topbar-inner">
  <a class="btn" href="../index.html">← Home</a>
  <a class="btn" href="./">Admin</a>
  <strong style="margin-left:.5rem">Add Item</strong>
</div></header>

<main class="container">
  <section class="pill">
    <form id="f" style="display:grid;grid-template-columns:repeat(2,minmax(0,1fr));gap:8px">
      <label>Category
        <select name="category" id="category" required>
          <option value="">Select category</option>
        </select>
      </label>
      <label>Title <input name="title" id="title" placeholder="e.g., MacBook Pro 14”"></label>

      <label>Brand <input name="brand" id="brand"></label>
      <label>Model <input name="model" id="model"></label>

      <label>Asset tag <input name="asset_tag" id="asset_tag"></label>
      <label>Serial <input name="serial" id="serial"></label>

      <label>User <input name="user" id="user"></label>
      <label>Email <input name="email" id="email"></label>

      <label>Location
        <select name="location" id="location">
          <option value="">Select location</option>
        </select>
      </label>
      <label>Room <input name="room" id="room"></label>

      <label>Dept <input name="dept" id="dept"></label>
      <label>Status <input name="status" id="status" placeholder="e.g., In use"></label>

      <label>Warranty Status
        <select name="warranty_status" id="warranty_status">
          <option value="">(none)</option>
          <option>Active</option>
          <option>Deactivated</option>
        </select>
      </label>
      <label>Warranty expires <input name="warranty_expires" id="warranty_expires" placeholder="YYYY-MM-DD"></label>

      <label>OS <input name="os" id="os"></label>
      <label>CPU <input name="cpu" id="cpu"></label>

      <label>RAM <input name="ram" id="ram"></label>
      <label>Storage <input name="storage" id="storage"></label>

      <label style="grid-column:1/-1">Notes <input name="notes" id="notes"></label>

      <button class="btn primary" type="submit" style="grid-column:1/-1">Save</button>
    </form>
    <pre id="out" class="small" style="margin-top:8px"></pre>
  </section>
</main>

<script>
// Load config (categories & locations) from the same service Edit uses
async function loadCfg(){
  try { const r = await fetch('/.netlify/functions/config'); if (r.ok) return await r.json(); } catch {}
  return (await (await fetch('../assets/config.json')).json());
}
function fillSelect(sel, items, placeholder){
  sel.innerHTML = '';
  if (placeholder) sel.insertAdjacentHTML('beforeend', `<option value="">${placeholder}</option>`);
  (items||[]).forEach(v => sel.insertAdjacentHTML('beforeend', `<option>${v}</option>`));
}
(async () => {
  const cfg = await loadCfg();
  fillSelect(document.getElementById('category'), cfg.categories || [], 'Select category');
  fillSelect(document.getElementById('location'),  cfg.locations  || [], 'Select location');
})();

const f = document.getElementById('f');
const out = document.getElementById('out');
f.addEventListener('submit', async (e) => {
  e.preventDefault();
  const x = Object.fromEntries(new FormData(f).entries());
  // strip empties
  Object.keys(x).forEach(k => { if(x[k]==='') delete x[k]; });
  const res = await fetch('/.netlify/functions/inventory', {
    method:'POST',
    headers:{'Content-Type':'application/json'},
    body: JSON.stringify({ item: x })
  });
  const txt = await res.text();
  out.textContent = txt;
  if (res.ok) f.reset();
});
</script>
</body>
</html>
